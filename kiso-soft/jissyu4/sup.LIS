                         4 .list
                         5 **
                         6 ** 順列計算の総和を求めるプログラム
                         7 **min.s
                         8 **
                         9 .section .text
                        10 **--------------------------------------
                        11 ** メインルーチン
                        12 **--------------------------------------
                        13 start:
000400 223C 1234        14 	move.l  #0x12345678, %d1 /* レジスタ退避を学ぶため、わざとレジスタd1に値を
       5678             14 
000406 43F9 0000        15 	lea.l   DATA,%a1/* サブルーチンに移る前の準備としてa1にDATAのアドレスを格
       0000             15 
00040c 4EBA 0006        16 	jsr SUP   /* SUPサブルーチンに移す */
000410 4E72 2700        17 	stop    #0x2700
                        18 **---------------------------------------
                        19 ** サブルーチン（順列計算の総和）
                        20 ** 入力（引き数）%a1:探索対象データの先頭アドレス
                        21 ** 出力（戻り値）%d0  :結果(総和)
                        22 ** nPrのrの部分　%d1
                        23 ** nPrのnの部分　%d2 （=7）
                        24 ** 乗算一時保存用%d3
                        25 ** データ長保存用%d4
                        26 **---------------------------------------
                        27 SUP:
000414 48E7 4040        28 	movem.l  %a1/%d1,-(%a7)   /* レジスタの退避（push）（a1,d1の値をスタックに格納
000418 4280             29 	clr.l    %d0 /* d0初期化 */
00041a 4281             30 	clr.l    %d1 /* d1初期化 */
00041c 4282             31 	clr.l    %d2 /* d2初期化 */
00041e 4283             32 	clr.l    %d3 /* d3初期化 */
000420 780C             33 	moveq.l  #LENGTH,%d4 /* d4 = LENGTH - 4 */
                        34 LOOP:
000422 0C44 0000        35 	cmp      #0, %d4
000426 6700 0024        36 	beq      BACK2MAIN  /* データをすべて探索したらメインルーチンに */
00042a 3219             37 	move.w   (%a1)+, %d1 /* d1にデータを入れる a1のアドレスを+2 */ 
00042c 343C 0007        38 	move     #7, %d2
000430 363C 0001        39 	move     #1, %d3
                        40 PERM:
000434 C6C2             41 	mulu     %d2, %d3
000436 0442 0001        42 	subi     #1, %d2
00043a 0441 0001        43 	subi     #1, %d1
00043e 6600 FFF4        44 	bne      PERM
000442 D043             45 	add      %d3, %d0
000444 0444 0001        46 	subi     #1, %d4
000448 6000 FFD8        47 	bra      LOOP
                        48 
                        49 BACK2MAIN:
00044c 4CDF 0202        50 	movem.l  (%a7)+,%a1/%d1   /* レジスタの復帰（pop）   */
000450 4E75             51 	rts /* サブルーチン呼び出し元に戻る */
                        52 **---------------------------------------
                        53 ** データエリア
                        54 **---------------------------------------
                        55 .section .data
                        56 	.equ   LENGTH, 12  /* データの個数 */
000454 0007 0005        57 	DATA:   dc.w   7,5,3,2,6,4,5,1,5,1,6,7
       0003 0002        57 
       0006 0004        57 
       0005 0001        57 
       0005 0001        57 
