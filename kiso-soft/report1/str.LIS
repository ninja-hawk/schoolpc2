                         4 .list
                         5 .section .text
                         6 start:
000400 7001              7 	move.l #1,%d0    /* STRUCTの引数*/
000402 4EBA 0006         8 	jsr    STRUCT    /* STRUCT(%d0.l) → NAME_DATA,ADDRESS_DATA */
000406 4E72 2700         9 	stop   #0x2700   /* プログラム終了*/
                        10 
                        11 **************************************************
                        12 ** 構造体の構造
                        13 **************************************************
                        14 .equ        NAME,0      /* NAME は先頭から0byte目*/
                        15 .equ        ADDRESS,20  /* ADDRESS は先頭から20byte目*/
                        16 .equ        SIZE,60     /* 一人分のデータサイズは60byte */
                        17 **************************************************
                        18 ** 構造体の要素を取り出すサブルーチン
                        19 **
                        20 ** 引数%d0.l = 構造体のインデックス番号
                        21 ** 戻り値NAME_DATA(名前のデータ)
                        22 **         ADDRESS_DATA(住所のデータ)
                        23 **************************************************
                        24 STRUCT:
                        25 	* レジスタ退避
00040a 48E7 FFFE        26 	movem.l  %d0-%d7/%a0-%a6,-(%sp)
                        27 	
00040e C0FC 003C        28 	mulu    #SIZE,%d0           /* d0.l=取り出すインデックス番号×60 */
000412 0680 0000        29 	add.l   #ADDRESS_BOOK,%d0   /* d0.l=取り出す要素の先頭アドレス*/
       0000             29 
000418 2040             30 	movea.l %d0,%a0             /* a0.l=d0.l */
                        31 	
00041a 7200             32 	moveq.l #0,%d1              /* d1.l=0 ループカウンタの初期化*/
00041c 45F9 0000        33 	lea.l   NAME_DATA,%a2       /* 書き出す領域の先頭アドレス*/
       0000             33 
000422 2248             34 	movea.l %a0,%a1             /* a1.l=a0 */
                        35 NAME_LOOP:      /* NAMEを書き出すルーチン*/
000424 14D9             36 	move.b  (%a1)+,(%a2)+       /* NAMEの書き出し*/
000426 5281             37 	addq.l  #1,%d1              /* ループカウンタ++ */
000428 0C81 0000        38 	cmp.l   #20,%d1             /* ループカウンタ<20 ならば*/
       0014             38 
00042e 6600 FFF4        39 	bne     NAME_LOOP           /* NAME_LOOPへ*/
                        40 	
000432 7200             41 	moveq.l #0,%d1              /* d1.l=0 ループカウンタの初期化*/
000434 45F9 0000        42 	lea.l   ADDRESS_DATA,%a2    /* 書き出す領域の先頭アドレス*/
       0000             42 
00043a 2248             43 	movea.l %a0,%a1             /* a1.l=a0.l */
00043c D3FC 0000        44 	adda.l  #ADDRESS,%a1        /* a1.l=a1.l+ADDRESS */
       0014             44 
                        45 ADDRESS_LOOP:   /* ADDRESSを書き出すルーチン*/
000442 14D9             46 	move.b  (%a1)+,(%a2)+       /* ADDRESSの書き出し*/
000444 5281             47 	addq.l  #1,%d1              /* ループカウンタ++ */
000446 0C81 0000        48 	cmp.l   #40,%d1             /* ループカウンタ<40ならば*/
       0028             48 
00044c 6600 FFF4        49 	bne     ADDRESS_LOOP        /* ADDRESS_LOOPへ*/
                        50 	
                        51 	* レジスタの復帰
000450 4CDF 7FFF        52 	movem.l (%sp)+,%d0-%d7/%a0-%a6
000454 4E75             53 	rts                         /* サブルーチンから復帰*/
                        54 **************************************************
                        55 ** 住所録
                        56 ** NAME の長さ20byte
                        57 ** ADDRESS の長さは40byte
                        58 **************************************************
                        59 .section .data
                        60 ADDRESS_BOOK:
000458 5441 524F        61 	.ascii  "TAROU               "    /* NAME */
       5520 2020        61 
       2020 2020        61 
       2020 2020        61 
       2020 2020        61 
00046c 4855 4B55        62 	.ascii  "HUKUOKASHI HIGASHIKU                    "  /* ADDRESS */
       4F4B 4153        62 
       4849 2048        62 
       4947 4153        62 
       4849 4B55        62 
000494 4841 4E41        63 	.ascii  "HANAKO              "    /* NAME */
       4B4F 2020        63 
       2020 2020        63 
       2020 2020        63 
       2020 2020        63 
0004a8 4855 4B55        64 	.ascii  "HUKUOKASHI MINAMIKU                     "  /* ADDRESS */
       4F4B 4153        64 
       4849 204D        64 
       494E 414D        64 
       494B 5520        64 
                        65 **************************************************
                        66 ** STRUCTの出力
                        67 **************************************************
0004d0 0000 0000        68 NAME_DATA:.ds.b 20                /* NAME出力先*/
       0000 0000        68 
       0000 0000        68 
       0000 0000        68 
       0000 0000        68 
0004e4 0000 0000        69 ADDRESS_DATA:   .ds.b 40          /* ADDRESS出力先*/
       0000 0000        69 
       0000 0000        69 
       0000 0000        69 
       0000 0000        69 
                        70 
                        71 .end
