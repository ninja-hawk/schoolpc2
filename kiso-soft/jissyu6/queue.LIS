                         4 .list
                         5  .section .text
                         6 ******************************
                         7 ** メインルーチン
                         8 ** a0:書き込むデータのアドレス
                         9 ** d4:書き込み回数
                        10 ******************************
                        11 Start:
000400 4EBA 0020        12 	jsr     Init_Q /* キューの初期化処理*/
000404 41F9 0000        13 	lea.l   Data_to_Que, %a0
       0000             13 
00040a 283C 0000        14 	move.l  #257, %d4
       0101             14 
                        15 
                        16 Loop1:
000410 5344             17 	subq.w  #1, %d4
000412 6500 000A        18 	bcs     End_program
000416 4EBA 002E        19 	jsr     In_Q/* 書き込み処理*/
00041a 6000 FFF4        20 	bra     Loop1
                        21 End_program:
00041e 4E72 2700        22 	stop    #0x2700
                        23 **********************
                        24 ** キューの初期化処理
                        25 **********************
                        26 Init_Q:
000422 45F9 0000        27 	lea.l   BF_START, %a2
       0000             27 
000428 23CA 0000        28 	move.l  %a2, PUT_PTR
       0000             28 
00042e 23CA 0000        29 	move.l  %a2, GET_PTR
       0000             29 
000434 13FC 00FF        30 	move.b  #0xff, PUT_FLG
       0000 0000        30 
00043c 13FC 0000        31 	move.b  #0x00, GET_FLG
       0000 0000        31 
000444 4E75             32 	rts
                        33 
                        34 ***********************************
                        35 ** In_Q キューへのデータ書き込み
                        36 ** a0:書き込むデータのアドレス
                        37 ** d0:結果(00:失敗, 00以外:成功)
                        38 ***********************************
                        39 In_Q:
000446 4EBA 0004        40 	jsr PUT_BUF/* キューへの書き込み*/
00044a 4E75             41 	rts
                        42 ****************************************
                        43 ** PUT_BUF
                        44 ** a0:書き込むデータのアドレス
                        45 ** d0:結果(00:失敗, 00以外:成功)
                        46 ****************************************
                        47 PUT_BUF:
00044c 48E7 0070        48 	movem.l %a1-%a3,-(%sp)
000450 1039 0000        49 	move.b  PUT_FLG, %d0
       0000             49 
000456 0C00 0000        50 	cmp.b   #0x00, %d0
00045a 6700 003E        51 	beq     PUT_BUF_Finish
00045e 2279 0000        52 	movea.l PUT_PTR, %a1
       0000             52 
000464 12D8             53 	move.b  (%a0)+,(%a1)+
000466 47F9 0000        54 	lea.l   BF_END, %a3
       0000             54 
00046c B3CB             55 	cmpa.l  %a3, %a1
00046e 6300 000A        56 	bls     PUT_BUF_STEP1
000472 45F9 0000        57 	lea.l   BF_START, %a2
       0000             57 
000478 224A             58 	movea.l %a2,%a1
                        59 PUT_BUF_STEP1:
00047a 23C9 0000        60 	move.l  %a1,PUT_PTR
       0000             60 
000480 B3F9 0000        61 	cmpa.l  GET_PTR,%a1
       0000             61 
000486 6600 000A        62 	bne     PUT_BUF_STEP2
00048a 13FC 0000        63 	move.b  #0x00,PUT_FLG
       0000 0000        63 
                        64 PUT_BUF_STEP2:
000492 13FC 00FF        65 	move.b  #0xff, GET_FLG
       0000 0000        65 
                        66 PUT_BUF_Finish:
00049a 4CDF 0E00        67 	movem.l (%sp)+, %a1-%a3 
00049e 4E75             68 	rts
                        69 .section .data
                        70 ******************************
                        71 ** キュー用のメモリ領域確保
                        72 ******************************
                        73 	.equ	B_SIZE, 256
0004a0 0000 0000        74 BF_START:	.ds.b	B_SIZE-1
       0000 0000        74 
       0000 0000        74 
       0000 0000        74 
       0000 0000        74 
00059f 00               75 BF_END:		.ds.b	1
0005a0 0000 0000        76 PUT_PTR:	.ds.l	1
0005a4 0000 0000        77 GET_PTR:	.ds.l	1
0005a8 00               78 PUT_FLG:	.ds.b	1
0005a9 00               79 GET_FLG:	.ds.b	1
                        80 ******************************
                        81 ** 書き込むデータ（サンプル）
                        82 ******************************
0005aa 4142 43          83 Data_to_Que:	.ascii	"ABC"
                        84 .end
